{% extends "base.html" %}

{% block content %}
<div
    style="max-width: 1100px; margin: 0 auto; display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; align-items: stretch;">

    <!-- Left: Upload Form & Guide -->
    <div style="flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 1rem;">
        <!-- Upload Form -->
        <div class="card" style="flex: 1; padding: 1.5rem;">
            <h2 style="text-align: center; color: var(--secondary-color); margin-bottom: 1rem; font-size: 1.5rem;">
                WhatsApp Chat Analysis
            </h2>
            <form action="/analyze/whatsapp" method="POST" enctype="multipart/form-data">

                <div class="upload-zone">
                    <input type="file" id="file" name="file" accept=".txt" required class="file-input">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <p class="upload-title"><strong>Click to upload</strong> or drag file here</p>
                        <p class="upload-subtitle">Supported Format: .txt</p>
                    </div>
                </div>

                <button type="submit" class="btn btn-secondary"
                    style="width: 100%; padding: 0.8rem; font-size: 1rem; margin-top: 1rem; border-radius: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 4px 6px rgba(37, 211, 102, 0.2);">
                    <i class="fas fa-rocket" style="margin-right: 8px;"></i> Analyze Chat
                </button>
            </form>
        </div>

        <!-- Tutorial Guide (Icons) - Restored 4 Steps -->
        <div class="card" style="padding: 0.8rem;">
            <h4 style="text-align: center; color: #555; margin-bottom: 0.5rem; font-size: 0.9rem;">
                <i class="fab fa-whatsapp" style="color: #25d366;"></i> Quick Guide
            </h4>
            <div class="steps-grid" style="justify-content: center; gap: 0.5rem;">
                <div class="step-card" style="min-width: 45px;">
                    <div class="step-icon" style="width: 30px; height: 30px; font-size: 0.8rem;"><i
                            class="fas fa-ellipsis-v"></i></div>
                    <div class="step-text" style="font-size: 0.7rem;">Menu</div>
                </div>
                <div class="step-card" style="min-width: 45px;">
                    <div class="step-icon" style="width: 30px; height: 30px; font-size: 0.8rem;"><i
                            class="fas fa-info-circle"></i></div>
                    <div class="step-text" style="font-size: 0.7rem;">More</div>
                </div>
                <div class="step-card" style="min-width: 45px;">
                    <div class="step-icon" style="width: 30px; height: 30px; font-size: 0.8rem;"><i
                            class="fas fa-file-export"></i></div>
                    <div class="step-text" style="font-size: 0.7rem;">Export</div>
                </div>
                <div class="step-card" style="min-width: 45px;">
                    <div class="step-icon" style="width: 30px; height: 30px; font-size: 0.8rem;"><i
                            class="fas fa-ban"></i></div>
                    <div class="step-text" style="font-size: 0.7rem;">No Media</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right: Video Player (Matching Height) -->
    <div style="flex: 0 0 300px; display: flex; flex-direction: column;">
        <div class="card" style="padding: 0; overflow: hidden; height: 100%; display: flex; flex-direction: column;">
            <h5
                style="text-align: center; padding: 8px; margin: 0; background: #f8f9fa; border-bottom: 1px solid #eee; color: #666; font-size: 0.9rem;">
                How to Export?</h5>
            <div style="flex: 1; background: black; display: flex; align-items: center; justify-content: center;">
                <video width="100%" style="max-height: 100%;" controls muted>
                    <source src="{{ url_for('static', filename='videos/videoplayback.mp4') }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('file');
    const uploadTitle = document.querySelector('.upload-title');
    const uploadIcon = document.querySelector('.upload-icon');
    const uploadZone = document.querySelector('.upload-zone');
    const defaultTitle = '<strong>Click to upload</strong> or drag file here';
    const defaultIconClass = 'fas fa-cloud-upload-alt upload-icon';

    fileInput.addEventListener('change', function () {
        if (this.files && this.files[0]) {
            const fileName = this.files[0].name;
            const fileExt = fileName.split('.').pop().toLowerCase();

            if (fileExt !== 'txt') {
                // INVALID FILE TYPE
                uploadTitle.innerHTML = `<strong>Error:</strong> Please upload .txt file only!`;
                uploadTitle.style.color = '#e53e3e'; // Red

                uploadIcon.className = 'fas fa-exclamation-triangle upload-icon';
                uploadIcon.style.color = '#e53e3e';

                uploadZone.style.borderColor = '#e53e3e';
                uploadZone.style.backgroundColor = '#fff5f5';

                // Clear the input
                this.value = '';
            } else {
                // VALID FILE
                uploadTitle.innerHTML = `<strong>Selected:</strong> ${fileName}`;
                uploadTitle.style.color = '#25d366'; // WhatsApp Green

                uploadIcon.className = 'fas fa-check-circle upload-icon';
                uploadIcon.style.color = '#25d366';

                uploadZone.style.borderColor = '#25d366';
                uploadZone.style.backgroundColor = '#f0fdf4';
            }
        } else {
            // RESET TO DEFAULT
            uploadTitle.innerHTML = defaultTitle;
            uploadTitle.style.color = '#4a5568';
            uploadIcon.className = defaultIconClass;
            uploadIcon.style.color = '#a0aec0';
            uploadZone.style.borderColor = '#cbd5e0';
            uploadZone.style.backgroundColor = 'linear-gradient(to bottom, #ffffff, #f7fafc)';
        }
    });
</script>
{% endblock %}